// 05-strings.nls
// Strings and text test script covering string operations, text elements, dialogues
// å­—ç¬¦ä¸²å’Œæ–‡æœ¬æµ‹è¯•è„šæœ¬ï¼Œæ¶µç›–å­—ç¬¦ä¸²æ“ä½œã€æ–‡æœ¬å…ƒç´ ã€å¯¹è¯ç­‰

// ===== åŸºç¡€å­—ç¬¦ä¸²æµ‹è¯• =====
// Basic string tests

// å­—ç¬¦ä¸²å­—é¢é‡
set singleQuote 'Hello, World!'
set doubleQuote "Hello, World!"
set emptyString ""
set singleChar "A"

// å­—ç¬¦ä¸²è®¿é—®
set str "Hello, World!"
set firstChar str[0]      // "H"
set lastChar str[-1]      // "!"
set charAtIndex str[7]    // "W"

// å­—ç¬¦ä¸²åˆ‡ç‰‡
set greeting "Hello, World!"
set slice1 greeting[1, 5]    // "ello"
set slice2 greeting[7,]      // "World!"
set slice3 greeting[, 5]     // "Hello"
set slice4 greeting[, -1]    // "Hello, World"

// å­—ç¬¦ä¸²æ‹¼æ¥
set firstName "John"
set lastName "Doe"
set fullName firstName + " " + lastName
set greeting2 "Hello, " + fullName + "!"

// ===== å­—ç¬¦ä¸²æ’å€¼æµ‹è¯• =====
// String interpolation tests

set playerName "Alice"
set playerLevel 25
set playerHealth 80

// åŸºç¡€æ’å€¼
set statusMessage "Player {playerName} is level {playerLevel}"

// è¡¨è¾¾å¼æ’å€¼
set healthMessage "Health: {playerHealth}/100 ({playerHealth * 100 / 100}%)"

// å¤æ‚æ’å€¼
set expNeeded 1000
set currentExp 750
set expMessage "XP: {currentExp}/{expNeeded} (Need {expNeeded - currentExp} more)"

// åµŒå¥—æ’å€¼
set timeHour 14
set timeMinute 30
set timeMessage "Current time: {timeHour < 10 ? "0" + timeHour : timeHour}:{timeMinute < 10 ? "0" + timeMinute : timeMinute}"

// ===== å­—ç¬¦ä¸²è½¬ä¹‰æµ‹è¯• =====
// String escape tests

// åŸºæœ¬è½¬ä¹‰
set newlineString "First line\nSecond line"
set tabString "Column1\tColumn2"
set quoteString "She said: \"Hello!\""
set backslashString "Path: C:\\Program Files\\App"

// Unicodeè½¬ä¹‰
set unicodeString "Emoji: \u{1F600} \u{1F44D}"
set chineseString "ä¸­æ–‡: \u{4E2D}\u{6587}"

// è½¬ä¹‰å¤§æ‹¬å·å’Œæ ‡ç­¾
set escapedBraces "Not interpolation: \{variable\}"
set escapedTags "Not a tag: \<b\>text\</b\>"

// ===== æ–‡æœ¬å…ƒç´ æµ‹è¯• =====
// Text elements tests

// ç²—ä½“æ–‡æœ¬
set boldText "This is <b>bold text</b> in the middle"
set allBoldText "This entire text is bold"b

// æ–œä½“æ–‡æœ¬
set italicText "This is <i>italic text</i> in the middle"
set allItalicText "This entire text is italic"i

// é¢œè‰²æ–‡æœ¬
set coloredText "This is <#ff0000>red text</> and <#00ff00>green text</>"
set namedColorText "This is <red>red</red> and <blue>blue</blue> text"
set allRedText "This entire text is red"#ff0000

// åµŒå¥—æ ·å¼
set nestedStyles "This is <b><i>bold and italic</i></b> text"
set colorAndBold "This is <red><b>red and bold</b></red> text"

// æ ·å¼ä¼˜å…ˆçº§
set priorityTest "<#000><#fff>This text is actually white</></>"

// ===== è‡ªå®šä¹‰å•è¯å…ƒç´ æµ‹è¯• =====
// Custom word elements tests

// Rubyæ³¨éŸ³
set rubyText "æ˜¨æ—¥ã€<p ruby="å›³æ›¸é¤¨">ã¨ã—ã‚‡ã‹ã‚“</p>ã§æœ¬ã‚’å€Ÿã‚Šã¾ã—ãŸã€‚"
set rubyVariations "æ±‰å­— <p ruby='pinyin'>hÃ nzÃ¬</p> æµ‹è¯•"
set rubyWithBraces "æµ‹è¯• <p ruby={"æ‹¼éŸ³"}>cÃ¨shÃ¬</p> åŠŸèƒ½"

// è‡ªå®šä¹‰å•è¯å±æ€§
set customWord "è¯·ä½ ï¼Œ<p cps=1 bold=true>ç­‰ï¼ä¸€ï¼ä¸‹ï¼</p>"
set slowText "è¿™é‡Œæœ‰<p cps=0.5>ç¼“æ…¢çš„æ–‡å­—</p>é€Ÿåº¦"

// ===== åœé¡¿å…ƒç´ æµ‹è¯• =====
// Pause elements tests

// åŸºç¡€åœé¡¿
set pauseText "è¿™é“é¢˜çš„ç­”æ¡ˆæ˜¯ï¼<pause /> 100ï¼"

// å¸¦æ—¶é—´çš„åœé¡¿
set timedPause "ç­‰å¾…ä¸­<pause duration={1000} />å®Œæˆï¼"
set timedPauseAlt "ç­‰å¾…ä¸­<pause duration=1000 />å®Œæˆï¼"

// ===== å­—ç¬¦ä¸²åŸç”Ÿæ–¹æ³•æµ‹è¯• =====
// String native methods tests

function testStringMethods() {
    var str "Hello, World!"
    
    // åŸºç¡€æ–¹æ³•
    var length str.length()
    var charAt str.charAt(1)
    var includes str.includes("World")
    var indexOf str.indexOf("o")
    var lastIndexOf str.lastIndexOf("o")
    
    // åˆ‡ç‰‡å’Œæˆªå–
    var slice str.slice(0, 5)
    var substring str.substring(7, 12)
    
    // å¤§å°å†™è½¬æ¢
    var upper str.toUpperCase()
    var lower str.toLowerCase()
    
    // å­—ç¬¦ä¸²å¤„ç†
    var trimmed "  spaced  ".trim()
    var repeated "hi".repeat(3)
    
    // å­—ç¬¦ä¸²æ£€æŸ¥
    var startsWith str.startsWith("Hello")
    var endsWith str.endsWith("!")
    
    // å­—ç¬¦ä¸²åˆ†å‰²å’Œæ›¿æ¢
    var split "a,b,c".split(",")
    var replaced str.replace("World", "NarraLang")
    
    return {
        length: length,
        charAt: charAt,
        includes: includes,
        indexOf: indexOf,
        upper: upper,
        lower: lower,
        split: split,
        replaced: replaced
    }
}

set stringMethodsResult testStringMethods()

// ===== å¤æ‚æ–‡æœ¬å¤„ç†æµ‹è¯• =====
// Complex text processing tests

// æ¨¡æ¿å­—ç¬¦ä¸²å‡½æ•°
function formatMessage(template, data) {
    var result template
    var keys data.keys()
    
    for each key in keys {
        var placeholder "{" + key + "}"
        var value data[key]
        set result result.replace(placeholder, value)
    }
    
    return result
}

set messageTemplate "Hello {name}, you have {count} {item}!"
set messageData {name: "Alice", count: 5, item: "messages"}
set formattedMessage formatMessage(messageTemplate, messageData)

// æ–‡æœ¬éªŒè¯å‡½æ•°
function validateText(text, maxLength = 100) {
    if text is null or text is "" {
        return {valid: false, error: "Text cannot be empty"}
    }
    
    if text.length() > maxLength {
        return {valid: false, error: "Text too long"}
    }
    
    if not text.includes(" ") and text.length() > 20 {
        return {valid: false, error: "Text might need spaces"}
    }
    
    return {valid: true}
}

set validText validateText("This is a valid message")
set invalidText validateText("")
set tooLongText validateText("a".repeat(150))

// æ–‡æœ¬æ¸…ç†å‡½æ•°
function cleanText(text) {
    var cleaned text.trim()
    
    // ç§»é™¤å¤šä½™ç©ºæ ¼
    while cleaned.includes("  ") {
        set cleaned cleaned.replace("  ", " ")
    }
    
    return cleaned
}

set messyText "  Hello    World   !  "
set cleanedText cleanText(messyText)

// ===== å¯¹è¯ç³»ç»Ÿæµ‹è¯• =====
// Dialogue system tests

// å®šä¹‰è§’è‰²
character John "John Smith"
character Alice "Alice Johnson"

// åŸºç¡€å¯¹è¯
John: "Hello, Alice! How are you today?"
Alice: "Hi John! I'm doing great, thanks for asking."

// å­—ç¬¦ä¸²è§’è‰²å¯¹è¯
"Narrator": "The two friends met in the park on a sunny afternoon."

// æ’å€¼å¯¹è¯
set location "library"
set time "morning"
John: "Let's meet at the {location} this {time}."

// å¸¦æ ·å¼çš„å¯¹è¯
Alice: "That sounds <b>great</b>! I'll bring my <i>favorite</i> book."
John: "Perfect! See you at <#00ff00>9 AM</>"

// åŠ¨æ€è§’è‰²å¯¹è¯
set currentSpeaker "Alice"
currentSpeaker: "This is a dynamic speaker test."

// è¡¨è¾¾å¼è§’è‰²å
set speakerIndex 1
set speakers ["John", "Alice"]
speakers[speakerIndex]: "Using expression for speaker name."

// ===== å¤šè¡Œå¯¹è¯æµ‹è¯• =====
// Multi-line dialogue tests

John: {
    "This is the first line of a multi-line dialogue."
    "This is the second line, spoken by the same character."
    "And this is the third line with {location} interpolation."
}

Alice: {
    "I can also speak multiple lines."
    "Each line is displayed separately."
    "But they're all from the same speaker."
}

// nullè§’è‰²å¤šè¡Œå¯¹è¯
null: {
    "This is narrator text without a character name."
    "Multiple lines of narration."
    "Very useful for longer descriptions."
}

// ===== æ—ç™½æµ‹è¯• =====
// Narration tests

// åŸºç¡€æ—ç™½
"The sun was setting over the horizon, painting the sky in brilliant shades of orange and pink."

// å¸¦æ ·å¼çš„æ—ç™½
"The <b>mysterious</b> figure approached slowly, their <i>footsteps</i> echoing in the <red>darkness</>."

// æ’å€¼æ—ç™½
set weather "stormy"
set visibility "poor"
"The weather was {weather} and visibility was {visibility}, making travel dangerous."

// å¸¦åœé¡¿çš„æ—ç™½
"There was a long silence<pause duration={2000} />and then everything changed."

// ===== å¯Œæ–‡æœ¬ç»„åˆæµ‹è¯• =====
// Rich text combination tests

// å¤æ‚æ ·å¼ç»„åˆ
set richText "This text has <b>bold</b>, <i>italic</i>, <red>color</red>, and even <b><i><blue>all combined</></></> formatting!"

// æ ·å¼ä¸æ’å€¼ç»“åˆ
set score 95
set rank "excellent"
set scoreText "Your score of <b>{score}</b> is <green>{rank}</green>!"

// å¤šå±‚åµŒå¥—
set playerName2 "Hero"
set questName "Dragon Slayer"
set reward 1000
set questText "Congratulations <b>{playerName2}</b>! You have completed the <i><blue>{questName}</></i> quest and earned <green><b>{reward} gold</b></green>!"

// ===== æ–‡æœ¬å›½é™…åŒ–æµ‹è¯• =====
// Text internationalization tests

// Unicodeå­—ç¬¦æ”¯æŒ
set unicodeText "Unicodeæ”¯æŒ: ğŸ®ğŸ¯ğŸ² Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ñ€ÑƒÑÑĞºĞ¸Ğ¹ æ—¥æœ¬èª"

// å¤šè¯­è¨€æ’å€¼
set lang "zh"
set username "ç”¨æˆ·"
set multiLangText lang is "zh" ? "æ¬¢è¿, {username}!" : "Welcome, {username}!"

// å­—ç¬¦ä¸²æ•°ç»„ç”¨äºå¤šè¯­è¨€
set messages {
    en: "Hello, World!",
    zh: "ä½ å¥½ï¼Œä¸–ç•Œï¼",
    ja: "ã“ã‚“ã«ã¡ã¯ã€ä¸–ç•Œï¼"
}

set currentLang "zh"
set localizedMessage messages[currentLang]

// ===== æ–‡æœ¬å·¥å…·å‡½æ•°æµ‹è¯• =====
// Text utility functions tests

// å­—ç¬¦ç»Ÿè®¡
function countCharacters(text) {
    var total text.length()
    var withoutSpaces text.replace(" ", "").length()
    var words text.split(" ").length()
    
    return {
        total: total,
        withoutSpaces: withoutSpaces,
        words: words
    }
}

set textStats countCharacters("Hello World! This is a test.")

// æ–‡æœ¬æˆªæ–­
function truncateText(text, maxLength, suffix = "...") {
    if text.length() <= maxLength {
        return text
    }
    
    return text.slice(0, maxLength - suffix.length()) + suffix
}

set longText "This is a very long text that needs to be truncated for display purposes."
set truncated truncateText(longText, 30)

// æ ‡ç­¾æ¸…ç†ï¼ˆæ¨¡æ‹Ÿï¼‰
function stripTags(text) {
    var result text
    
    // ç®€å•çš„æ ‡ç­¾ç§»é™¤ï¼ˆå®é™…å®ç°ä¼šæ›´å¤æ‚ï¼‰
    while result.includes("<") and result.includes(">") {
        var startTag result.indexOf("<")
        var endTag result.indexOf(">")
        if startTag >= 0 and endTag > startTag {
            var before result.slice(0, startTag)
            var after result.slice(endTag + 1)
            set result before + after
        } else {
            break
        }
    }
    
    return result
}

set taggedText "This is <b>bold</b> and <i>italic</i> text."
set plainText stripTags(taggedText)

// æµ‹è¯•å®Œæˆ
set stringsTestCompleted true

"Strings and text test completed successfully"
